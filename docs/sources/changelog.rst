===========================
Doma 2 における主要な変更点
===========================

Doma 1.36.0 からの変更点の内、主なものを示しています。

全般
====

* Java 8 に対応しました。Java 7 以前では動作しません。

* deprecated な API が削除されました。

設定
====

* ``Config`` の実装クラスをシングルトンとして扱えるように ``@SingletonConfig`` が追加されました。

* トランザクション処理を簡易化するために ``LocalTransactionManage`` が追加されました。

* クエリをカスタマイズ可能にするために ``QueryImplementors`` と ``CommandImplementors`` が追加されました。

* 結果セットに未知のカラムが含まれていた場合の挙動をカスタマイズ可能にするために
  ``UnknownColumnHandler`` が追加されました。

* ``AbstractDomaConfing`` が削除されました。
  このクラスが提供していた実装は ``Config`` のデフォルトメソッドで提供されるようになりました。

* ``DefaultClassHelper`` が削除されました。
  このクラスが提供していた実装は ``ClassHelper`` のデフォルトメソッドで提供されるようになりました。

* ``NullRequiresNewController`` が削除されました。
  このクラスが提供していた実装は ``RequiresNewController`` のデフォルトメソッドで提供されるようになりました。

基本型
======

* ``Object`` 型が基本型と認識されるようになりました。

* 基本型を要素とする ``java.util.Optional`` 型が基本型として認識されるようになりました。

ドメインクラス
==============

* ``@Domain`` を使ってドメインクラスを作った場合、デフォルトではnullを受け入れなくなりました。

* ドメインクラスを要素とする ``java.util.Otional`` 型がドメインクラスとして認識されるようになりました。

エンティティクラス
=================

* 実験的な扱いだったイミュータブルなエンティティが正式にサポートされました。

Daoインタフェース
=================

* ``java.util.Stream`` を使った検索ができるようになりました。

* ``@Delegate`` が廃止になり代わりにデフォルトメソッドが使えるようになりました。

* ``IterationCallback`` を使った検索方法が変わりました。
  ``@Select`` の ``iterate`` 要素の代わりに ``strategy`` 要素を使って示す必要があります。

*  ``java.util.Function`` に合わせて ``IterationCallback`` の型パラメータの順番を入れ替えました。

* ``PostIterationCallback`` が削除されました。
  このクラスが提供していた実装は ``IterationCallback`` のデフォルトメソッドで提供されるようになりました。

SQLに関する変更
===============

特にありません。

式言語
======

* 組み込み関数 ``contain`` を削除しました。

トランザクション
================

* トランザクション処理を宣言的に示す ``@UnitOfWork`` が追加されました。
  他のライブラリとの連携で利用されることを意図しています。

注釈処理
========

* 注釈処理のオプションの名前に ``doma`` という名前空間を付与しました。
  Doma 以外の注釈処理のオプションとキーが重複することを避けるためです。

ビルド
======

* DomaのjarをMavenのセントラルリポジトリから提供するようにしました。


